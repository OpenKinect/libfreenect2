<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>libfreenect2: API Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="Doxyextra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libfreenect2
   &#160;<span id="projectnumber">0.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">API Reference </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Older versions: <a href="0.1">0.1</a>.</p><h1>Introduction </h1>
<p>libfreenect2 is an open source cross-platform driver for Kinect for Windows v2 devices. For information on installation and troubleshooting, see the <a href="https://github.com/OpenKinect/libfreenect2">GitHub repository</a>.</p>
<p>This documentation is designed for application developers who want to extract and use depth and color images from Kinect v2 for further processing. Additional questions and comments not covered by this documentation can be posted to <a href="https://github.com/OpenKinect/libfreenect2/issues">GitHub issues</a>.</p>
<p>This documentation may require some understanding on camera calibration and 3-D geometry.</p>
<h1>Features </h1>
<ul>
<li>Color image processing</li>
<li>IR and depth image processing</li>
<li>Registration of color and depth images</li>
<li>Multiple GPU and hardware acceleration implementations for image processing</li>
</ul>
<h3>Issues and Future Work</h3>
<ul>
<li>Audio. Raw audio is accessible via Linux USB audio. There is no support for the calibrated directional audio.</li>
<li>Unstable USB and crashes. Due to differences in driver support, USB problems can happen a lot. Error handling in libfreenect2 is not fully verified for production use.</li>
<li>Firmware upload. The protocol has been reverse engineered, but use Windows for this right now.</li>
<li>Example of multiple Kinects.</li>
<li>Example utility of dumping image frames.</li>
<li>API for on-demand processing.</li>
<li>Verification of systematic errors through accurate calibration.</li>
<li>Bindings for C, Python, Java, etc.</li>
</ul>
<h1>Getting Started </h1>
<p>To read the API documentation, start with the <a href="modules.html">Modules</a> page which nicely organizes classes according to their functionalities.</p>
<p>Example programs can be found in the source distribution under the <code>examples</code> directory. There also includes an example CMake build system for a standalone application that uses libfreenect2 binary installation.</p>
<p>Many internal details are hidden from this public API. For details on Kinect v2's USB protocols, depth decoding algorithms, calibration algorithms, and how to implement performance optimizers, you are encouraged to read the source code. The source code is the updated and authoritative reference for any functionalities.</p>
<h1>Environment Variables </h1>
<p>There are a few environment variables providing controls for both end-users and programmers:</p>
<p><code>LIBFREENECT2_LOGGER_LEVEL</code>: The default logging level if not explicitly set by the code. <code>LIBFREENECT2_PIPELINE</code>: The default pipeline if not explicitly set by the code. <code>LIBFREENECT2_RGB_TRANSFER_SIZE</code>, <code>LIBFREENECT2_RGB_TRANSFERS</code>, <code>LIBFREENECT2_IR_PACKETS</code>, <code>LIBFREENECT2_IR_TRANSFERS</code>: Tuning the USB buffer sizes. Use only if you know what you are doing.</p>
<p>You can also see the following walkthrough for the most basic usage.</p>
<h1>Walkthrough </h1>
<p>Here is an example to walk you through the API. See <code>examples/Protonect.cpp</code> for the full source.</p>
<h2>Headers </h2>
<p>First, include necessary headers. <code><a class="el" href="registration_8h.html" title="Class for merging depth and color frames. ">registration.h</a></code> and <code><a class="el" href="logger_8h.html" title="Declaration of logging classes. ">logger.h</a></code> are optional if you don't use them.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="libfreenect2_8hpp.html">libfreenect2/libfreenect2.hpp</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="frame__listener__impl_8h.html">libfreenect2/frame_listener_impl.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="registration_8h.html">libfreenect2/registration.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="packet__pipeline_8h.html">libfreenect2/packet_pipeline.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="logger_8h.html">libfreenect2/logger.h</a>&gt;</span></div></div><!-- fragment --> <h2>Logging </h2>
<p>This shows how to set up the logger and logging level.</p>
<div class="fragment"><div class="line">  <a class="code" href="group__logging.html#ga739dd7279f2841fc2edb8fb0a27d8f2c">libfreenect2::setGlobalLogger</a>(<a class="code" href="group__logging.html#ga4f8c6057270c1bebc09496bc83b760b2">libfreenect2::createConsoleLogger</a>(<a class="code" href="classlibfreenect2_1_1Logger.html#a221b779e6bb7b8d40677d7642bfefac5ac909e86054cb6ad83c22bfc2b3e6e5b8">libfreenect2::Logger::Debug</a>));</div></div><!-- fragment --><p> Though libfreenect2 will have an initial global logger created with <a class="el" href="group__logging.html#gadff624881d39d5100ebea6716996e09e" title="Default is Info, or overridden by environment variable LIBFREENECT2_LOGGER_LEVEL. ...">createConsoleLoggerWithDefaultLevel()</a>. You do not have to explicitly call this if the default is already what you want.</p>
<p>You can implement a custom <a class="el" href="classlibfreenect2_1_1Logger.html">Logger</a> and redirect libfreenect2's log messages to desired places.</p>
<p>Here is an example to save log messages to a file.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;cstdlib&gt;</span></div><div class="line"><span class="keyword">class </span>MyFileLogger: <span class="keyword">public</span> <a class="code" href="classlibfreenect2_1_1Logger.html">libfreenect2::Logger</a></div><div class="line">{</div><div class="line"><span class="keyword">private</span>:</div><div class="line">  std::ofstream logfile_;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">  MyFileLogger(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (filename)</div><div class="line">      logfile_.open(filename);</div><div class="line">    level_ = <a class="code" href="classlibfreenect2_1_1Logger.html#a221b779e6bb7b8d40677d7642bfefac5ac909e86054cb6ad83c22bfc2b3e6e5b8">Debug</a>;</div><div class="line">  }</div><div class="line">  <span class="keywordtype">bool</span> good()</div><div class="line">  {</div><div class="line">    <span class="keywordflow">return</span> logfile_.is_open() &amp;&amp; logfile_.good();</div><div class="line">  }</div><div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classlibfreenect2_1_1Logger.html#a15b1a05d027d43172115a135726e33bb">log</a>(Level level, <span class="keyword">const</span> std::string &amp;message)</div><div class="line">  {</div><div class="line">    logfile_ &lt;&lt; <span class="stringliteral">&quot;[&quot;</span> &lt;&lt; <a class="code" href="classlibfreenect2_1_1Logger.html#a88a22ae4be0cfd8a5d1830522beb9e9e">libfreenect2::Logger::level2str</a>(level) &lt;&lt; <span class="stringliteral">&quot;] &quot;</span> &lt;&lt; message &lt;&lt; std::endl;</div><div class="line">  }</div><div class="line">};</div></div><!-- fragment --><p> And use it</p>
<div class="fragment"><div class="line">  MyFileLogger *filelogger = <span class="keyword">new</span> MyFileLogger(getenv(<span class="stringliteral">&quot;LOGFILE&quot;</span>));</div><div class="line">  <span class="keywordflow">if</span> (filelogger-&gt;good())</div><div class="line">    <a class="code" href="group__logging.html#ga739dd7279f2841fc2edb8fb0a27d8f2c">libfreenect2::setGlobalLogger</a>(filelogger);</div><div class="line">  <span class="keywordflow">else</span></div><div class="line">    <span class="keyword">delete</span> filelogger;</div></div><!-- fragment --><p> libfreenect2 uses a single global logger regardless of number of contexts and devices. You may have to implement thread safety measure in <a class="el" href="classlibfreenect2_1_1Logger.html#a15b1a05d027d43172115a135726e33bb">log()</a>, which is called from multiple threads. Console loggers are thread safe because <code>std::cout</code> and <code>std::cerr</code> are thread safe.</p>
<h2>Initialize and Discover Devices </h2>
<p>You need these structures for all operations. Here it uses only one device.</p>
<div class="fragment"><div class="line">  <a class="code" href="classlibfreenect2_1_1Freenect2.html">libfreenect2::Freenect2</a> freenect2;</div><div class="line">  <a class="code" href="classlibfreenect2_1_1Freenect2Device.html">libfreenect2::Freenect2Device</a> *dev = 0;</div><div class="line">  <a class="code" href="classlibfreenect2_1_1PacketPipeline.html">libfreenect2::PacketPipeline</a> *pipeline = 0;</div></div><!-- fragment --><p> You must enumerate all Kinect v2 devices before doing anything else related to devices.</p>
<div class="fragment"><div class="line">  <span class="keywordflow">if</span>(freenect2.<a class="code" href="classlibfreenect2_1_1Freenect2.html#ac7c87454b2270b68ed326e4022f72997">enumerateDevices</a>() == 0)</div><div class="line">  {</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;no device connected!&quot;</span> &lt;&lt; std::endl;</div><div class="line">    <span class="keywordflow">return</span> -1;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (serial == <span class="stringliteral">&quot;&quot;</span>)</div><div class="line">  {</div><div class="line">    serial = freenect2.<a class="code" href="classlibfreenect2_1_1Freenect2.html#a47064dca4e315e838e4e09a279aaf991">getDefaultDeviceSerialNumber</a>();</div><div class="line">  }</div></div><!-- fragment --><p> Also, you can create a specific <a class="el" href="classlibfreenect2_1_1PacketPipeline.html">PacketPipeline</a> instead using the default one for opening the device. Alternatives include <a class="el" href="classlibfreenect2_1_1OpenGLPacketPipeline.html">OpenGLPacketPipeline</a>, <a class="el" href="classlibfreenect2_1_1OpenCLPacketPipeline.html">OpenCLPacketPipeline</a>, etc.</p>
<div class="fragment"><div class="line">        pipeline = <span class="keyword">new</span> <a class="code" href="classlibfreenect2_1_1CpuPacketPipeline.html">libfreenect2::CpuPacketPipeline</a>();</div></div><!-- fragment --> <h2>Open and Configure the Device </h2>
<p>Now you can open the device by its serial number, and using the specific pipeline.</p>
<div class="fragment"><div class="line">    dev = freenect2.<a class="code" href="classlibfreenect2_1_1Freenect2.html#a04d710e4e641ce337dd60b085259ab00">openDevice</a>(serial, pipeline);</div></div><!-- fragment --><p> You can also open the device without providing a pipeline, then a default is used. There are a few alternative ways to <a class="el" href="classlibfreenect2_1_1Freenect2.html#a04d710e4e641ce337dd60b085259ab00">openDevice()</a>.</p>
<p>After opening, you need to attach <a class="el" href="classlibfreenect2_1_1FrameListener.html">Framelisteners</a> to the device to receive images frames.</p>
<p>This <a class="el" href="classlibfreenect2_1_1SyncMultiFrameListener.html">SyncMultiFrameListener</a> will wait until all specified types of frames are received once. Like loggers, you may also implement your own frame listeners using the same interface.</p>
<div class="fragment"><div class="line">  <span class="keywordtype">int</span> types = 0;</div><div class="line">  <span class="keywordflow">if</span> (enable_rgb)</div><div class="line">    types |= <a class="code" href="classlibfreenect2_1_1Frame.html#a1d1cfd8ffb84e947f82999c682b666a7a0d368292f17012d66912908725eaedbb">libfreenect2::Frame::Color</a>;</div><div class="line">  <span class="keywordflow">if</span> (enable_depth)</div><div class="line">    types |= <a class="code" href="classlibfreenect2_1_1Frame.html#a1d1cfd8ffb84e947f82999c682b666a7a1b799ef75fd52a850bc21d80ae25f62a">libfreenect2::Frame::Ir</a> | <a class="code" href="classlibfreenect2_1_1Frame.html#a1d1cfd8ffb84e947f82999c682b666a7af5c0a1b2ee6f0c691d602752b185463c">libfreenect2::Frame::Depth</a>;</div><div class="line">  <a class="code" href="classlibfreenect2_1_1SyncMultiFrameListener.html">libfreenect2::SyncMultiFrameListener</a> listener(types);</div><div class="line">  <a class="code" href="group__frame.html#gaf723a84f8c4a2e24e08e206a0ca1aaa7">libfreenect2::FrameMap</a> frames;</div><div class="line"></div><div class="line">  dev-&gt;<a class="code" href="classlibfreenect2_1_1Freenect2Device.html#ab560718080b719410d01daf1f737c71a">setColorFrameListener</a>(&amp;listener);</div><div class="line">  dev-&gt;<a class="code" href="classlibfreenect2_1_1Freenect2Device.html#a3b1a4e555fcb53131197fdb6f682fe7d">setIrAndDepthFrameListener</a>(&amp;listener);</div></div><!-- fragment --><p> You cannot configure the device after starting it.</p>
<h2>Start the Device </h2>
<p>After finishing configuring the device, you can start the device. You must start the device before querying any information of the device.</p>
<div class="fragment"><div class="line">  <span class="keywordflow">if</span> (enable_rgb &amp;&amp; enable_depth)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (!dev-&gt;<a class="code" href="classlibfreenect2_1_1Freenect2Device.html#ad64c54ab3191981b2443c47007f38516">start</a>())</div><div class="line">      <span class="keywordflow">return</span> -1;</div><div class="line">  }</div><div class="line">  <span class="keywordflow">else</span></div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (!dev-&gt;<a class="code" href="classlibfreenect2_1_1Freenect2Device.html#ad09e5158767f65d125f9ff8b2b3582d1">startStreams</a>(enable_rgb, enable_depth))</div><div class="line">      <span class="keywordflow">return</span> -1;</div><div class="line">  }</div><div class="line"></div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;device serial: &quot;</span> &lt;&lt; dev-&gt;<a class="code" href="classlibfreenect2_1_1Freenect2Device.html#ac260b57b2365339382fc0e368bfcc001">getSerialNumber</a>() &lt;&lt; std::endl;</div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;device firmware: &quot;</span> &lt;&lt; dev-&gt;<a class="code" href="classlibfreenect2_1_1Freenect2Device.html#a28d9092a14e5e9162bb4580ec5fa0665">getFirmwareVersion</a>() &lt;&lt; std::endl;</div></div><!-- fragment --><p> You can <a class="el" href="classlibfreenect2_1_1Freenect2Device.html#a3343e3656ef4ea26650f7e2884aa129c">setIrCameraParams()</a> after start if you have your own depth calibration parameters.</p>
<p>Otherwise you can also use the factory preset parameters for <a class="el" href="classlibfreenect2_1_1Registration.html">Registration</a>. You can also provide your own depth calibration parameterss (though not color camera calibration parameters right now). Registration is optional.</p>
<div class="fragment"><div class="line">  <a class="code" href="classlibfreenect2_1_1Registration.html">libfreenect2::Registration</a>* registration = <span class="keyword">new</span> <a class="code" href="classlibfreenect2_1_1Registration.html">libfreenect2::Registration</a>(dev-&gt;<a class="code" href="classlibfreenect2_1_1Freenect2Device.html#ab376836bb0392eecf7a4590592ae1589">getIrCameraParams</a>(), dev-&gt;<a class="code" href="classlibfreenect2_1_1Freenect2Device.html#ab970e88b4c18121755dd063d52dde965">getColorCameraParams</a>());</div><div class="line">  <a class="code" href="classlibfreenect2_1_1Frame.html">libfreenect2::Frame</a> undistorted(512, 424, 4), registered(512, 424, 4);</div></div><!-- fragment --><p> At this time, the processing has begun, and the data flows through the pipeline towards your frame listeners.</p>
<h2>Receive Image Frames </h2>
<p>This example uses a loop to receive image frames.</p>
<div class="fragment"><div class="line">  <span class="keywordflow">while</span>(!protonect_shutdown &amp;&amp; (framemax == (<span class="keywordtype">size_t</span>)-1 || framecount &lt; framemax))</div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (!listener.waitForNewFrame(frames, 10*1000)) <span class="comment">// 10 sconds</span></div><div class="line">    {</div><div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;timeout!&quot;</span> &lt;&lt; std::endl;</div><div class="line">      <span class="keywordflow">return</span> -1;</div><div class="line">    }</div><div class="line">    <a class="code" href="classlibfreenect2_1_1Frame.html">libfreenect2::Frame</a> *rgb = frames[<a class="code" href="classlibfreenect2_1_1Frame.html#a1d1cfd8ffb84e947f82999c682b666a7a0d368292f17012d66912908725eaedbb">libfreenect2::Frame::Color</a>];</div><div class="line">    <a class="code" href="classlibfreenect2_1_1Frame.html">libfreenect2::Frame</a> *ir = frames[<a class="code" href="classlibfreenect2_1_1Frame.html#a1d1cfd8ffb84e947f82999c682b666a7a1b799ef75fd52a850bc21d80ae25f62a">libfreenect2::Frame::Ir</a>];</div><div class="line">    <a class="code" href="classlibfreenect2_1_1Frame.html">libfreenect2::Frame</a> *depth = frames[<a class="code" href="classlibfreenect2_1_1Frame.html#a1d1cfd8ffb84e947f82999c682b666a7af5c0a1b2ee6f0c691d602752b185463c">libfreenect2::Frame::Depth</a>];</div></div><!-- fragment --><p> <a class="el" href="classlibfreenect2_1_1SyncMultiFrameListener.html#aa4a75e5aeb32f142c8f50b6031134d0c">waitForNewFrame()</a> here will block until required frames are all received, and then you can extract <code>Frame</code> according to the type.</p>
<p>See <a class="el" href="classlibfreenect2_1_1Frame.html" title="Frame format and metadata. ">libfreenect2::Frame</a> for details about pixel format, dimensions, and metadata.</p>
<p>You can do your own things using the frame data. You can feed it to OpenCV, PCL, etc. Here, you can perform registration:</p>
<div class="fragment"><div class="line">      registration-&gt;<a class="code" href="classlibfreenect2_1_1Registration.html#a6a8021003dedc97465fb4e34a57d5b5f">apply</a>(rgb, depth, &amp;undistorted, &amp;registered);</div></div><!-- fragment --><p> After you are done with this frame, you must release it.</p>
<div class="fragment"><div class="line">    listener.release(frames);</div><div class="line">  }</div></div><!-- fragment --> <h2>Stop the Device </h2>
<p>If you are finished and no longer need to receive more frames, you can stop the device and exit.</p>
<div class="fragment"><div class="line">  dev-&gt;<a class="code" href="classlibfreenect2_1_1Freenect2Device.html#a913e49a415a81ff266f461523a0c66da">stop</a>();</div><div class="line">  dev-&gt;<a class="code" href="classlibfreenect2_1_1Freenect2Device.html#aad0a9e425479bdb0239facdf6626fbc8">close</a>();</div></div><!-- fragment --> <h2>Pause the Device </h2>
<p>You can also temporarily pause the device with <a class="el" href="classlibfreenect2_1_1Freenect2Device.html#a913e49a415a81ff266f461523a0c66da">stop()</a> and <a class="el" href="classlibfreenect2_1_1Freenect2Device.html#ad64c54ab3191981b2443c47007f38516">start()</a>.</p>
<div class="fragment"><div class="line">  <span class="keywordflow">if</span> (protonect_paused)</div><div class="line">    devtopause-&gt;start();</div><div class="line">  <span class="keywordflow">else</span></div><div class="line">    devtopause-&gt;stop();</div><div class="line">  protonect_paused = !protonect_paused;</div></div><!-- fragment --><p> Doing this during <code>waitForNewFrame()</code> should be thread safe, and tests also show well. But a guarantee of thread safety has not been checked yet.</p>
<p>THE END. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Apr 27 2016 14:16:00 for libfreenect2 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
